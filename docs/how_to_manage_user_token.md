## How to Manage User Token

### Back End
To prevent user from accessing protected data, a secure mechanism using [JWT](https://www.npmjs.com/package/jsonwebtoken) (Json Web Token) is implemented in the project. Here is the workflow of JWT
1. Once a user logs in successfully, a token is generated by JWT and the token is stored in `httpOnly` cookie in the response object.
2. The `httpOnly` cookie is set to expire in some time (This is time period is defined in `.evn` - EXPIRESIN).
3. `httpOnly` cookie can not be accessed by javascript. This means there will no token to be directly used in the front end.
4. However, everytime a user hits an api, the `request` will automatically include the `httpOnly` cookie.
5. In order to verify whether a user has the right token to access certain protected api, there is a middleware named `verifyToken` to do the job. See usage in [user.js](../src/server/router/user.js) (line 60).

### Front End
User context is manager by `UserContext` object. It provides standard user information including `user`, `email`, `id`, `type`. See usage in [Navbar.js](../src/client/components/Navbar.js)
1. **Error Handing**. Since the `fetch` api will automatically include `httpOnly` cookie in the request, there is not much to handle in front end. However, the server may return error regarding invalid token (`code == 2`), the front end does have to handle the error in case of an expired token.
2. **Refresh**. When a user refreshes the page, the user state will be no longer in memory, but the cookie will be there. To identify who is the current user, there is an additional api `/api/me` to help accomplish that. The api simply verifies the token in the cookie and decode it. All the user data can be retrieved from the decoded token.
3. **Log Out**. There is not a simple and yet elegant way in the JWT community for handing log out. It generally involves a lot of extra work and other infostructure setup (like a centeral authorization management). Right now, there is an api `/api/logout` to clear the `token` cookie so that front end no longer has a valid token.
